# åŸºäºYOLOv8çš„å°‘æ ·æœ¬å·¥ä¸šé›¶ä»¶ç¼ºé™·æ£€æµ‹ç³»ç»Ÿ


## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªç»“åˆ YOLOv8 ç›®æ ‡æ£€æµ‹å’ŒåŸå‹ç½‘ç»œ (Prototypical Networks) çš„å°‘æ ·æœ¬å·¥ä¸šé›¶ä»¶ç¼ºé™·æ£€æµ‹ç³»ç»Ÿã€‚é’ˆå¯¹å·¥ä¸šåœºæ™¯ä¸­â€œæ­£å¸¸æ ·æœ¬å¤šã€ç¼ºé™·æ ·æœ¬å°‘ã€æ–°ç¼ºé™·ç±»å‹å±‚å‡ºä¸ç©·â€çš„ç—›ç‚¹ï¼Œç³»ç»Ÿèƒ½å¤Ÿåœ¨ä»…æä¾›æå°‘é‡ï¼ˆå¦‚ 5 å¼ ï¼‰æ–°ç¼ºé™·å›¾ç‰‡çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å…ƒå­¦ä¹ å…ˆéªŒçŸ¥è¯†ä¸åŠ¨æ€å†»ç»“å¾®è°ƒæŠ€æœ¯ï¼Œå®ç°å¯¹æ–°ç¼ºé™·çš„ç²¾å‡†æ£€æµ‹ã€‚

### âœ¨ æ ¸å¿ƒåˆ›æ–°ç‚¹

1. **æ··åˆæ¶æ„è®¾è®¡ (ProtoYOLO)**ï¼šå°† YOLOv8 å¼ºå¤§çš„é€šç”¨ç‰¹å¾æå–èƒ½åŠ›ä¸åŸå‹ç½‘ç»œçš„å°‘æ ·æœ¬åº¦é‡å­¦ä¹ èƒ½åŠ›æ·±åº¦èåˆã€‚
2. **åŒæ¨¡å¼è®­ç»ƒä½“ç³»**ï¼šæ”¯æŒåŸºç¡€ YOLO å…¨ç›‘ç£è®­ç»ƒï¼ˆè·å–å…ˆéªŒç‰¹å¾ï¼‰ä¸ Meta-Learning å…ƒå­¦ä¹ è®­ç»ƒï¼ˆè·å¾—æ³›åŒ–èƒ½åŠ›ï¼‰ã€‚
3. **åŠ¨æ€å°‘æ ·æœ¬å¾®è°ƒç­–ç•¥**ï¼šé¢å¯¹å…¨æ–°ç¼ºé™·ï¼Œç³»ç»Ÿè‡ªåŠ¨æå– 5-shot æ”¯æŒé›†ï¼Œå†»ç»“å‰ 10 å±‚éª¨å¹²ç½‘ï¼Œä»…å¾®è°ƒæ£€æµ‹å¤´ï¼Œ1åˆ†é’Ÿå†…å³å¯ç”Ÿæˆä¸“å±æ¨¡å‹ã€‚
4. **ç±»åˆ«ç¼ºé™·èšåˆæœºåˆ¶**ï¼šæ”¯æŒåŒä¸€ç±»åˆ«çš„å¤šç§ç¼ºé™·åˆå¹¶è®­ç»ƒï¼Œç»Ÿä¸€è¾“å‡ºç±»åˆ« IDï¼Œé¿å…æ¨¡å‹å†—ä½™ã€‚
5. **ç°ä»£åŒ–äº¤äº’ç•Œé¢ (PyQt5 GUI)**ï¼š
   * çœŸæ­£çš„å…¨å±€æš—é»‘æ¨¡å¼ (Dark Mode)ã€‚
   * ç‹¬åˆ›çš„å¯äº¤äº’ç¼©æ”¾è§†å›¾ï¼ˆæ”¯æŒæ»šè½®æ— æŸç¼©æ”¾ã€é¼ æ ‡å¹³ç§»ï¼Œç½®ä¿¡åº¦æŠ—é”¯é½¿æ˜¾ç¤ºï¼‰ã€‚
   * è‡ªåŠ¨æ‰«æå†å²ç¼ºé™·ï¼Œæ”¯æŒä¸€é”®å¢åˆ ç±»åˆ«ä¸åŠ¨æ€è®­ç»ƒã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ·±åº¦å­¦ä¹ æ¡†æ¶**: PyTorch 2.0+
- **æ£€æµ‹æ¨¡å‹**: YOLOv8 (Ultralytics)
- **å°‘æ ·æœ¬å­¦ä¹ **: Prototypical Networks (Meta-Learning)
- **æ•°æ®å¢å¼º**: Albumentations (ç¦»çº¿å¢å¼º)
- **GUI æ¡†æ¶**: PyQt5
- **æ•°æ®é›†**: MVTec AD

---

## ğŸ“¦ ä¾èµ–å®‰è£…

### 1. ç¯å¢ƒè¦æ±‚
- Python 3.8+
- CUDA 11.0+ (ä½¿ç”¨ GPU æ—¶)
- æ˜¾å­˜ â‰¥ 8GB (æ¨è)

### 2. å®‰è£…æ­¥éª¤

```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–åŒ…
pip install -r requirements.txt

# ä¿®å¤ PyTorch ä¸ Numpy ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ (é‡è¦)
pip install -U "numpy>=2.0.0"

# å®‰è£… Ultralytics (YOLOv8)
pip install ultralytics
```

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
FewShotDefectDetection/
â”œâ”€â”€ configs/                 # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ train_config.yaml    # è®­ç»ƒå‚æ•°é…ç½®
â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ gui_config.json      # GUI çŠ¶æ€ä¸æ¨¡å‹æŒä¹…åŒ–é…ç½®
â”‚   â”œâ”€â”€ processed/           # é¢„å¤„ç†åçš„ MVTec æ•°æ®é›† (YAMLä¸å›¾ç‰‡)
â”‚   â””â”€â”€ support_sets/        # å°‘æ ·æœ¬å¾®è°ƒæ—¶çš„æ”¯æ’‘é›†å›¾ç‰‡ç¼“å­˜
â”œâ”€â”€ experiments/             # æ¨¡å‹æƒé‡ä¿å­˜ç›®å½•
â”‚   â”œâ”€â”€ checkpoints/         # å…ƒå­¦ä¹ æœ€ä½³æƒé‡
â”‚   â”œâ”€â”€ finetune_yolo/       # å…¨ç›‘ç£ YOLO æœ€ä½³æƒé‡
â”‚   â””â”€â”€ few_shot_task/       # åŠ¨æ€ç”Ÿæˆçš„å°‘æ ·æœ¬ä¸“å±æ¨¡å‹
â”œâ”€â”€ scripts/                 # æ ¸å¿ƒæ‰§è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ prepare_mvtec.py     # æ©ç è½¬ BBox åŠæ•°æ®é¢„å¤„ç†
â”‚   â”œâ”€â”€ augment_offline.py   # æ•°æ®ç¦»çº¿å¢å¼º
â”‚   â”œâ”€â”€ train_yolo.py        # åŸºç¡€å…¨ç›‘ç£è®­ç»ƒ
â”‚   â”œâ”€â”€ train_meta.py        # å…ƒå­¦ä¹ åŸå‹ç½‘ç»œè®­ç»ƒ
â”‚   â””â”€â”€ few_shot_adapt.py    # GUI åå°è°ƒç”¨çš„å°‘æ ·æœ¬å¾®è°ƒæ ¸å¿ƒ
â”œâ”€â”€ src/                     # æºä»£ç 
â”‚   â”œâ”€â”€ models/              # æ¨¡å‹å®šä¹‰ (ProtoYOLO, åŸå‹ç½‘ç»œ)
â”‚   â”œâ”€â”€ training/            # è®­ç»ƒå™¨å®ç° (MetaTrainer)
â”‚   â””â”€â”€ gui/                 # å›¾å½¢ç•Œé¢
â”‚       â””â”€â”€ system_window.py # ç°ä»£åŒ–ä¸»çª—å£æ ¸å¿ƒä»£ç 
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®å‡†å¤‡

#### ä¸‹è½½MVTec ADæ•°æ®é›†

è®¿é—® [MVTec ADå®˜ç½‘](https://www.mvtec.com/company/research/datasets/mvtec-ad) ä¸‹è½½æ•°æ®é›†

#### é¢„å¤„ç†æ•°æ®

```bash
# å°†æ©ç è½¬æ¢ä¸º YOLO æ ¼å¼è¾¹ç•Œæ¡†å¹¶åˆ’åˆ†æ•°æ®é›†
python scripts/prepare_mvtec.py --data_root data/raw --output_dir data/processed
```


### 2. æ¨¡å‹è®­ç»ƒ

#### å…ƒè®­ç»ƒ (Meta-Training)

```bash
python scripts/train_meta.py --config configs/train_config.yaml
```

å…³é”®å‚æ•°é…ç½® (åœ¨train_config.yamlä¸­):
```yaml
few_shot:
  n_way: 5          # æ¯ä¸ªepisodeçš„ç±»åˆ«æ•°
  k_shot: 5         # æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°
  query_num: 10     # æ¯ä¸ªç±»åˆ«çš„æŸ¥è¯¢æ ·æœ¬æ•°

training:
  num_epochs: 200
  lr: 0.001
  batch_size: 1
```

### 3. GUIè¿è¡Œ

```bash
python src/gui/system_window.py
```

åŠŸèƒ½è¯´æ˜ï¼šåœ¨ GUI ä¸­ï¼Œä½ å¯ä»¥æ£€æµ‹å›¾ç‰‡/è§†é¢‘æµã€åŠ¨æ€æ·»åŠ æ–°ç¼ºé™·å¹¶è‡ªåŠ¨å¼€å¯å°‘æ ·æœ¬å¾®è°ƒï¼Œè¿˜å¯ä»¥è¿›è¡Œæ— æŸç¼©æ”¾æŸ¥çœ‹æ£€æµ‹ç»†èŠ‚ã€‚

---

## ğŸ’¡ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. æ©ç è½¬è¾¹ç•Œæ¡† (mask_to_bbox.py)

**åŠŸèƒ½**: ç³»ç»ŸåŒ…å«è‡ªåŠ¨è½¬æ¢å·¥å…·ï¼Œèƒ½å°† MVTec AD çš„åƒç´ çº§äºŒå€¼æ©ç ï¼Œè‡ªåŠ¨è¿‡æ»¤å¾®å°å™ªç‚¹ï¼ˆmin_areaï¼‰ï¼Œå¹¶è½¬æ¢ä¸º YOLO æ ¼å¼çš„å½’ä¸€åŒ–è¾¹ç•Œæ¡†æ ‡æ³¨ class_id x_center y_center width heightã€‚

### 2. Proto-YOLO æ¶æ„ (proto_yolo.py)

**åŠŸèƒ½**: ç»“åˆäº† YOLOv8 çš„ Backbone (CSPDarknet53) å’Œç‰¹å¾é‡‘å­—å¡” (FPN+PANet)ï¼Œåœ¨è®­ç»ƒæ—¶åˆ†ç¦»å‡ºæ”¯æŒé›† (Support Set) å’ŒæŸ¥è¯¢é›† (Query Set)ï¼Œé€šè¿‡è®¡ç®— Prototypical Loss æ›´æ–° Backbone å‚æ•°ï¼Œä½¿å…¶å…·å¤‡æ³›åŒ–èƒ½åŠ›ã€‚

### 3. åŠ¨æ€å°‘æ ·æœ¬å¾®è°ƒ (few_shot_adapt.py)

**æ ¸å¿ƒç®—æ³•**: è¿™æ˜¯ GUI è”åŠ¨çš„æ ¸å¿ƒæ¨¡å—ã€‚å½“ç”¨æˆ·åœ¨ç•Œé¢ä¸Šä¼  5 å¼ æ–°ç¼ºé™·å›¾ç‰‡æ—¶ï¼Œè¯¥è„šæœ¬ä¼šï¼š
1. æå–ä¹‹å‰è®­ç»ƒå¥½çš„ Meta æƒé‡ä½œä¸ºéª¨å¹²ã€‚
2. å¼ºåˆ¶å†»ç»“å‰ 10 å±‚ç½‘ç»œ (Freeze=10)ã€‚
3. é‡ç½®æœ€åä¸€å±‚æ£€æµ‹å¤´ï¼Œå¹¶é’ˆå¯¹æ–°ä¸Šä¼ çš„ 5 å¼ å›¾è¿›è¡Œå¿«é€Ÿå¾®è°ƒ (Transfer Learning)ã€‚
4. è¿”å›å…¨æ–°çš„ .pt æ¨¡å‹è·¯å¾„ä¾› GUI å®æ—¶æŒ‚è½½ä½¿ç”¨ã€‚

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è®­ç»ƒæ—¶æ˜¾å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```yaml
# åœ¨train_config.yamlä¸­è°ƒæ•´
training:
  batch_size: 1        # å‡å°batch size
  use_amp: true        # å¯ç”¨æ··åˆç²¾åº¦

model:
  yolo_weights: "yolov8n.pt"  # ä½¿ç”¨æ›´å°çš„æ¨¡å‹

data:
  image_size: 512      # å‡å°å›¾åƒå°ºå¯¸
```

### Q2: å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†

1. å‡†å¤‡æ•°æ®é›†ç›®å½•ç»“æ„:
```
your_dataset/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ val/
â”‚   â””â”€â”€ test/
â””â”€â”€ labels/  (YOLOæ ¼å¼)
    â”œâ”€â”€ train/
    â”œâ”€â”€ val/
    â””â”€â”€ test/
```

2. ä¿®æ”¹dataset.yaml:
```yaml
path: path/to/your_dataset
train: images/train
val: images/val
nc: 3  # ç±»åˆ«æ•°
names: ['crack', 'scratch', 'dent']
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### è®ºæ–‡

1. **YOLOv8**: Ultralytics YOLOv8 Documentation
2. **Prototypical Networks**: Snell et al., "Prototypical Networks for Few-shot Learning", NeurIPS 2017
3. **MVTec AD**: Bergmann et al., "MVTec AD - A Comprehensive Real-World Dataset", CVPR 2019
4. **Meta-Learning**: Finn et al., "Model-Agnostic Meta-Learning", ICML 2017

### ä»£ç å‚è€ƒ

- [Ultralytics YOLOv8](https://github.com/ultralytics/ultralytics)
- [PyTorch Prototypical Networks](https://github.com/jakesnell/prototypical-networks)
- [MVTec AD Dataset](https://www.mvtec.com/company/research/datasets/mvtec-ad)

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œæ•°æ®é›†:
- Ultralytics YOLOv8
- PyTorch
- MVTec AD Dataset
- Albumentations
- PyQt5

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚å¦‚éœ€ç”¨äºå•†ä¸šç”¨é€”ï¼Œè¯·è”ç³»ä½œè€…ã€‚
=======
# FewShotDefectDetection
åŸºäºyolov8çš„å°‘æ ·æœ¬å·¥ä¸šç¼ºé™·é›¶ä»¶æ£€æµ‹ç³»ç»Ÿ
